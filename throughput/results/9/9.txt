BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%steel%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 268845402.782706
 ALGERIA                   |   1997 | 461013856.739191
 ALGERIA                   |   1996 | 465088591.750461
 ALGERIA                   |   1995 | 468624623.257457
 ALGERIA                   |   1994 | 461232400.090181
 ALGERIA                   |   1993 | 467347438.970812
 ALGERIA                   |   1992 | 467412467.321148
 ARGENTINA                 |   1998 | 275219644.557107
 ARGENTINA                 |   1997 | 471031028.263511
 ARGENTINA                 |   1996 | 471593339.493573
 ARGENTINA                 |   1995 |  467794585.95398
 ARGENTINA                 |   1994 | 471251408.963805
 ARGENTINA                 |   1993 | 470642250.131602
 ARGENTINA                 |   1992 | 465891012.445009
 BRAZIL                    |   1998 | 272697128.044974
 BRAZIL                    |   1997 | 460620590.907387
 BRAZIL                    |   1996 | 460682227.577993
 BRAZIL                    |   1995 | 462497955.935107
 BRAZIL                    |   1994 | 465684553.219051
 BRAZIL                    |   1993 |  468070130.96922
 BRAZIL                    |   1992 | 463533275.496578
 CANADA                    |   1998 | 276775275.663866
 CANADA                    |   1997 | 483470908.916268
 CANADA                    |   1996 | 481384968.926818
 CANADA                    |   1995 | 476717083.575432
 CANADA                    |   1994 | 485177488.162696
 CANADA                    |   1993 | 475521766.359299
 CANADA                    |   1992 | 476497356.076934
 CHINA                     |   1998 | 274215801.893561
 CHINA                     |   1997 | 469701857.024203
 CHINA                     |   1996 | 468343774.627711
 CHINA                     |   1995 | 461161738.091212
 CHINA                     |   1994 | 466780744.179903
 CHINA                     |   1993 | 469078414.676703
 CHINA                     |   1992 | 466381523.545582
 EGYPT                     |   1998 | 277179067.794184
 EGYPT                     |   1997 | 465410169.146913
 EGYPT                     |   1996 | 468470018.103589
 EGYPT                     |   1995 |  465182966.34082
 EGYPT                     |   1994 | 462813581.247582
 EGYPT                     |   1993 | 473406278.693671
 EGYPT                     |   1992 | 463992535.883185
 ETHIOPIA                  |   1998 | 271012961.824814
 ETHIOPIA                  |   1997 | 462570157.676266
 ETHIOPIA                  |   1996 | 453293993.960998
 ETHIOPIA                  |   1995 | 458936998.718937
 ETHIOPIA                  |   1994 | 467376507.638236
 ETHIOPIA                  |   1993 | 450973977.472173
 ETHIOPIA                  |   1992 | 470505710.939588
 FRANCE                    |   1998 | 271344676.050661
 FRANCE                    |   1997 | 464418075.586606
 FRANCE                    |   1996 | 467536568.797426
 FRANCE                    |   1995 | 465249366.918393
 FRANCE                    |   1994 | 464903294.464139
 FRANCE                    |   1993 | 469740259.212023
 FRANCE                    |   1992 | 472021982.508075
 GERMANY                   |   1998 | 273182589.840687
 GERMANY                   |   1997 | 465983778.814967
 GERMANY                   |   1996 | 471490575.777457
 GERMANY                   |   1995 | 469460574.272199
 GERMANY                   |   1994 | 467209513.123539
 GERMANY                   |   1993 | 468732950.334112
 GERMANY                   |   1992 |  468684683.59487
 INDIA                     |   1998 | 277204137.053401
 INDIA                     |   1997 | 469678648.562233
 INDIA                     |   1996 | 473588669.673633
 INDIA                     |   1995 | 463447235.672348
 INDIA                     |   1994 | 470112804.493049
 INDIA                     |   1993 | 467614924.029913
 INDIA                     |   1992 | 466306005.021614
 INDONESIA                 |   1998 | 278490230.425378
 INDONESIA                 |   1997 | 468102395.968344
 INDONESIA                 |   1996 | 467545500.535804
 INDONESIA                 |   1995 | 467959867.508023
 INDONESIA                 |   1994 | 464917827.729784
 INDONESIA                 |   1993 | 473979350.187056
 INDONESIA                 |   1992 | 460691838.529711
 IRAN                      |   1998 | 267326690.690019
 IRAN                      |   1997 | 465448344.567771
 IRAN                      |   1996 | 457039709.275224
 IRAN                      |   1995 | 458623854.876279
 IRAN                      |   1994 |  458133298.78183
 IRAN                      |   1993 | 457705501.445937
 IRAN                      |   1992 | 463190883.793816
 IRAQ                      |   1998 | 275097746.162662
 IRAQ                      |   1997 | 472391192.991483
 IRAQ                      |   1996 | 477906832.525816
 IRAQ                      |   1995 |  470443666.25364
 IRAQ                      |   1994 | 468337488.222084
 IRAQ                      |   1993 | 483680628.230477
 IRAQ                      |   1992 | 478044169.850388
 JAPAN                     |   1998 |  269423187.62931
 JAPAN                     |   1997 | 467761769.042806
 JAPAN                     |   1996 | 469086767.534142
 JAPAN                     |   1995 | 468746134.467575
 JAPAN                     |   1994 | 467816241.780542
 JAPAN                     |   1993 | 476375723.262125
 JAPAN                     |   1992 | 472594763.023765
 JORDAN                    |   1998 |  269539155.19123
 JORDAN                    |   1997 | 454690600.606854
 JORDAN                    |   1996 | 456613634.713024
 JORDAN                    |   1995 | 459864499.581482
 JORDAN                    |   1994 | 458149428.051848
 JORDAN                    |   1993 | 456977370.612151
 JORDAN                    |   1992 | 455792753.187062
 KENYA                     |   1998 | 279823708.634551
 KENYA                     |   1997 | 480888847.454068
 KENYA                     |   1996 | 481733393.172172
 KENYA                     |   1995 | 471781264.534502
 KENYA                     |   1994 | 468801417.523947
 KENYA                     |   1993 | 473894642.230532
 KENYA                     |   1992 | 470141797.374495
 MOROCCO                   |   1998 | 274580680.764144
 MOROCCO                   |   1997 | 475430687.147717
 MOROCCO                   |   1996 | 469640975.470349
 MOROCCO                   |   1995 | 472115655.326844
 MOROCCO                   |   1994 | 472712646.035187
 MOROCCO                   |   1993 | 474159119.233702
 MOROCCO                   |   1992 | 475996703.203852
 MOZAMBIQUE                |   1998 | 277827662.837337
 MOZAMBIQUE                |   1997 | 461085360.339513
 MOZAMBIQUE                |   1996 | 463901493.336225
 MOZAMBIQUE                |   1995 | 466280103.011082
 MOZAMBIQUE                |   1994 | 466636175.066145
 MOZAMBIQUE                |   1993 | 465432964.707901
 MOZAMBIQUE                |   1992 | 458142671.135737
 PERU                      |   1998 | 274592620.729007
 PERU                      |   1997 | 467678033.216884
 PERU                      |   1996 | 467677756.632943
 PERU                      |   1995 | 463608784.811555
 PERU                      |   1994 | 465648841.891208
 PERU                      |   1993 | 465158692.437336
 PERU                      |   1992 | 471559159.197045
 ROMANIA                   |   1998 | 275977482.800554
 ROMANIA                   |   1997 | 477668590.700152
 ROMANIA                   |   1996 | 470528557.089906
 ROMANIA                   |   1995 | 470677224.358053
 ROMANIA                   |   1994 | 469958757.083788
 ROMANIA                   |   1993 | 470898993.754661
 ROMANIA                   |   1992 | 474585564.599278
 RUSSIA                    |   1998 | 268771167.469142
 RUSSIA                    |   1997 | 467596846.180331
 RUSSIA                    |   1996 |  476625728.92691
 RUSSIA                    |   1995 |  471025964.34636
 RUSSIA                    |   1994 | 466487188.704518
 RUSSIA                    |   1993 | 472291907.023517
 RUSSIA                    |   1992 | 465057912.865531
 SAUDI ARABIA              |   1998 | 273090274.201933
 SAUDI ARABIA              |   1997 | 473222159.541719
 SAUDI ARABIA              |   1996 | 472953998.785045
 SAUDI ARABIA              |   1995 | 469329959.662722
 SAUDI ARABIA              |   1994 | 468087616.120864
 SAUDI ARABIA              |   1993 | 468243723.541803
 SAUDI ARABIA              |   1992 |  468921405.11719
 UNITED KINGDOM            |   1998 | 263373600.358365
 UNITED KINGDOM            |   1997 | 467479734.925592
 UNITED KINGDOM            |   1996 | 472400414.181767
 UNITED KINGDOM            |   1995 | 463039411.227609
 UNITED KINGDOM            |   1994 | 462259215.389352
 UNITED KINGDOM            |   1993 |  463320968.61202
 UNITED KINGDOM            |   1992 | 468291827.063679
 UNITED STATES             |   1998 | 281147389.758825
 UNITED STATES             |   1997 | 479640974.699058
 UNITED STATES             |   1996 |  470301411.32025
 UNITED STATES             |   1995 | 470270245.656666
 UNITED STATES             |   1994 | 468077670.311898
 UNITED STATES             |   1993 | 471982859.406288
 UNITED STATES             |   1992 | 471936082.799231
 VIETNAM                   |   1998 | 276754757.633066
 VIETNAM                   |   1997 | 467519890.883856
 VIETNAM                   |   1996 | 474484288.715748
 VIETNAM                   |   1995 | 468456804.603782
 VIETNAM                   |   1994 | 468250814.719969
 VIETNAM                   |   1993 | 466132275.231711
 VIETNAM                   |   1992 | 461847738.325868
(175 rows)

COMMIT;
COMMIT
